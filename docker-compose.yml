services:
  valheim-server:
    build: .
    image: drummercraig/valheim-server:latest
    container_name: valheim-server
    cap_add:
      - sys_nice
    ports:
      - "${GAME_PORT:-2456}:${GAME_PORT:-2456}/udp"
      - "${QUERY_PORT:-2457}:${QUERY_PORT:-2457}/udp"
      - "${CROSSPLAY_PORT:-2458}:${CROSSPLAY_PORT:-2458}/udp"
    volumes:
      - ${USERFILES_PATH:-./userfiles}:/userfiles
      - ${SERVERFILES_PATH:-./serverfiles}:/opt/valheim
    env_file:
      - .env
    restart: unless-stopped
    stop_grace_period: 2m
    deploy:
      resources:
        limits:
          memory: ${MEMORY_LIMIT:-6G}
        reservations:
          memory: ${MEMORY_RESERVATION:-2G}